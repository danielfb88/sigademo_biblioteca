<?php
/* Copyright 2006, 2007, 2008, 2009, 2010 do SETEC/MEC
 *
 * Este arquivo é parte do programa SigaEPT
 *
 * O SigaEPT é um software livre;  você pode redistribuí-lo e/ou modificá-lo dentro dos
 * termos da Licença Pública Geral GNU como publicada pela fundação do software livre (FSF);
 * na versão 2 da Licença.
 *
 * Este programa é distribuído na esperança que possa ser útil, mas SEM NENHUMA GARANTIA; sem
 * uma garantia implícita de ADEQUAÇÃO a qualquer MERCADO ou APLICAÇÃO EM PARTICULAR. Veja Licença
 * Pública Geral GNU/GPL em português para maiores detalhes.
 *
 * Você deve ter recebido uma cópia da Licença Pública Geral GNU, sob o título “LICENCA.txt”,
 * junto com este programa, se não, acesse o portal do Software Público Brasileiro no endereço
 * www.softwarepublico.gov.br ou escreva para Fundação do Software Livre (FSF) Inc.,51 Franklin
 * St, Fifth Floor, Boston, MA 02110-1301, USA
 */
?>
<?php
/**
* @package SIGA
* @subpackage Biblioteca
* @author SETEC/MEC
*/

class frmCatalogacaoPeriodicoFichas extends MTabbedForm
{
	function __construct($idPeriodico)
    {
        
	parent::__construct('Title: TabbedForm Tutorial');
        $this->SetPainterMethod('javascript'); 
        $this->width = '100%';
        $periodico = $this->manager->getBusiness('biblioteca','periodico');
        $periodico->GetById($idPeriodico);
        $this->header = '<b>Categoria:&nbsp;</b>' . $periodico->GetCategoria(). '&nbsp;&nbsp;&nbsp;' . '<b>ISSN:&nbsp;</b>' . $periodico->issn . '&nbsp;&nbsp;&nbsp;' . '<b>Título:&nbsp;</b>' . $periodico->titulo;
        $this->pagewidth = 140;
        $this->pageheight = 350;
        
        // Botão 'fechar', direcionando para o handler biblioteca/main/catalogacao
	$this->SetClose($this->manager->GetActionURL($module, 'main:catalogacao:periodicos'));
        
        $ui = $this->manager->getUI();
        // insere ficha da obra
        $data = new FormData();
        $data->idPeriodico = $idPeriodico;
        $formPeriodico = $ui->getForm('biblioteca',"frmCatalogacaoFichaPeriodico", $data, 'periodicos');
        $this->AddPage($formPeriodico);
        
        // insere as demais fichas
        
        $fichas = $periodico->GetFichas(); //testado.
                
        while (! $fichas->eof)
        {                       
            $subficha = trim($fichas->fields('titulo'));
            switch ($subficha)
            {
                case 'Líder': $s = 'Leader'; break;
                case '006'  : $s = '006'; break;
                case '007'  : $s = '007'; break;
                case '008'  : $s = '008'; break;
                case 'Campos Variáveis'  : $s = 'Var'; break;

            }

            $data = $fichas->getRowObject();
            $data->idPeriodico = $idPeriodico;
            $form[$fichas->fields('idsubficha')] = $ui->getForm('biblioteca',"frmCatalogacaoFicha$s", $data, 'periodicos');
            $this->AddPage($form[$fichas->fields('idsubficha')]);
            $fichas->moveNext();
        } 
	if ($this->page->IsPostBack())
	{
            $this->EventHandler();
	}
        else
        {
                // para pesquisa por termo catalogado, já abre na aba campos variáveis
                if($this->GetFormValue('event') == 'PesquisaCatalog')
                {
                        $this->SetCurrentPage(4);
                }
        }
        
        $this->defaultButton = false;
	}
    
}

?>
