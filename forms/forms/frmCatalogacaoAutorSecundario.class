<?php
/* Copyright 2006, 2007, 2008, 2009, 2010 do SETEC/MEC
 *
 * Este arquivo é parte do programa SigaEPT
 *
 * O SigaEPT é um software livre;  você pode redistribuí-lo e/ou modificá-lo dentro dos
 * termos da Licença Pública Geral GNU como publicada pela fundação do software livre (FSF);
 * na versão 2 da Licença.
 *
 * Este programa é distribuído na esperança que possa ser útil, mas SEM NENHUMA GARANTIA; sem
 * uma garantia implícita de ADEQUAÇÃO a qualquer MERCADO ou APLICAÇÃO EM PARTICULAR. Veja Licença
 * Pública Geral GNU/GPL em português para maiores detalhes.
 *
 * Você deve ter recebido uma cópia da Licença Pública Geral GNU, sob o título “LICENCA.txt”,
 * junto com este programa, se não, acesse o portal do Software Público Brasileiro no endereço
 * www.softwarepublico.gov.br ou escreva para Fundação do Software Livre (FSF) Inc.,51 Franklin
 * St, Fifth Floor, Boston, MA 02110-1301, USA
 */
?>
<?php
/**
* @package SIGA
* @subpackage Biblioteca
* @author SETEC/MEC
*/



class frmCatalogacaoAutorSecundario  extends MForm
{
    public $obra;
    public $operacao;
    public $usuario;
    public $idObra;

    var $objAutor;
    var $objObra;


    function __construct($data)
    {
         global $MIOLO,$module;      


          $this->idObra = $data->idobra;
	
   		//Chama o CreateFileds, etc.
   		$this->EventHandler();

        $this->idObra = $data->idobra;
        parent::__construct('Relação de Autores Secundários');

        
        //Botão "enviar" não aparece
		   $this->defaultButton = false; 

       // Botão 'fechar', direcionando para o handler biblioteca/main/catalogacao
		 $this->SetClose($this->manager->GetActionURL($module, 'main:catalogacao'));


    }

    function CreateFields()
    {
       	global $MIOLO, $module, $self, $theme, $action, $page,$item;
       
        $this->objObra = $MIOLO->GetBusiness($module,'obra');    
        $idobra = $this->objObra->GetById($item);
        $button = new MButton('btnVoltar','Voltar');
        $goto = $MIOLO->GetActionURL($module, 'main:catalogacao:catalogacao', $item);
		$this->AddButton(new FormButton('btnVoltar',"Ir para Catalogação da obra $idobra->numeroDaObra",$goto));
        $columns = array(
			new DataGridColumn(null),
			new DataGridColumn('conteudo','Nome','left',true, '50%'),
			new DataGridColumn('ocorrencia','Ocorrencia','center', true, '50%')
			);

		$href_datagrid = $MIOLO->GetActionURL($module,$self,'', Array('event'=>''));
		$page->SetAction($href_datagrid);


		 //Instancia o objeto autor

	    $this->objAutor = $MIOLO->GetBusiness($module,'autor');
		$query = $this->objAutor->GetAutorSecundarioByObra2($item);
		$datagrid = new DataGrid2($query, $columns, $href_datagrid,20);
		//$datagrid->SetTitle('Relação de Autores Secundários');
		$datagrid->SetLinkType('linkbutton');
		$datagrid->SetWidth('100%');

      	$href_dele = $MIOLO->GetActionURL($module,$self,'%0%',Array('event'=>'btnExcluir:click'));


		$datagrid->AddActionIcon('Excluir', 'delete.gif', $href_dele);
		

	//	$datagrid->HeaderLink('new', 'Novo Registro',$MIOLO->GetActionURL($module,$self,'',Array('event'=>'')));
//                                                //$MIOLO->GetActionURL($module = $module , 'catalogacaoautorsecundario', $this->idObra)),

	   	$datagrid->HeaderLink('new', 'Novo Registro',$MIOLO->GetActionURL($module = $module  ,'catalogacaonovoautorsec', $item));
		$theme->InsertContent($datagrid);
		
	
		

	
	 }




	function btnExcluir_click()
	{ 
		global $MIOLO, $module, $item, $action;
		
	  
		//Instancia o objeto obra

	    $this->objObra = $MIOLO->GetBusiness($module,'obra');    

        $idobra = $this->objObra->GetIdobraByIdmaterial($item);
        $query = $this->objObra->deleteMaterialAutorSec($item);
        $item = $idobra;
        //var_dump("Opa");
}


   function btnAutorSecundario_click()
    {
       	global $MIOLO, $module, $self, $theme, $action, $page,$item;
		$columns = array(
			new DataGridColumn(null),
			new DataGridColumn('Nome','Conteudo','left',true, '50%',true, null, true,true),
			new DataGridColumn('Ocorrencia','Ocorrencia','center', true, '50%',true, null, true,true)
			);


		$href_datagrid = $MIOLO->GetActionURL($module,$self,'', Array('event'=>'btnAutorSecundario_click()'));
		$page->SetAction($href_datagrid);



		 //Instancia o objeto autor

	    $this->objAutor = $MIOLO->GetBusiness($module,'autor');




		$query = $this->objAutor->GetAutorSecundarioByObra($item);
		$datagrid = new DataGrid2($query, $columns, $href_datagrid,20);
		$datagrid->SetTitle('Relação de Autores Secundários');
		$datagrid->SetLinkType('linkbutton');
		$datagrid->SetWidth('100%');
		$datagrid->HeaderLink('new', 'Novo Registro',
		
		$MIOLO->GetActionURL($module,$self,'',Array('event'=>'')));
		$theme->InsertContent($datagrid);
		


    }

}

?>
