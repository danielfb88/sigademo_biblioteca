<?php
/* Copyright 2006, 2007, 2008, 2009, 2010 do SETEC/MEC
 *
 * Este arquivo é parte do programa SigaEPT
 *
 * O SigaEPT é um software livre;  você pode redistribuí-lo e/ou modificá-lo dentro dos
 * termos da Licença Pública Geral GNU como publicada pela fundação do software livre (FSF);
 * na versão 2 da Licença.
 *
 * Este programa é distribuído na esperança que possa ser útil, mas SEM NENHUMA GARANTIA; sem
 * uma garantia implícita de ADEQUAÇÃO a qualquer MERCADO ou APLICAÇÃO EM PARTICULAR. Veja Licença
 * Pública Geral GNU/GPL em português para maiores detalhes.
 *
 * Você deve ter recebido uma cópia da Licença Pública Geral GNU, sob o título “LICENCA.txt”,
 * junto com este programa, se não, acesse o portal do Software Público Brasileiro no endereço
 * www.softwarepublico.gov.br ou escreva para Fundação do Software Livre (FSF) Inc.,51 Franklin
 * St, Fifth Floor, Boston, MA 02110-1301, USA
 */
?>
<?php
/**
* @package SIGA
* @subpackage Biblioteca
* @author SETEC/MEC
*/



class frmMultaUsuario extends Form
{

	var $objMulta;
	var $objUsuario;

	function __construct()
    {  
		global $MIOLO, $action;

		$this->Form('Multas');
		$this->SetTitle(NULL);
		$this->EventHandler();
 		$this->defaultButton = false;
 		
	}

    function CreateFields()
	{	
		global $MIOLO, $module, $self, $theme, $action, $page;

		//Busca idusuario
	    //$idusuario = $this->manager->GetLogin()->idkey;
        $usuario = $this->manager->getBusiness('common','usuario');
		$usuario->getByLogin($this->manager->GetLogin()->id);
		$idusuario = $usuario->idUsuario;

		//Datagrid de multas
		$columns = array(
			new DataGridColumn('idemprestimo','Cód. Empréstimo','center',true, '15%',true, null, false, false),
			new DataGridColumn('numerodotombo','Exemplar','center',true, '15%',true, null, false, false),
			new DataGridColumn('datahora','Data','center',true, '15%',true, null, false, false),
			new DataGridColumn('valor','Valor','center',true, '15%',true, null, false, false),
			new DataGridColumn('observacao','Observação','left',true, '25%',true, null, false, false),
			new DataGridColumn('foipaga','Foi Paga?','center',true, '15%',true, null, false, false),
			);

		//Instancia o objeto multa
	    $this->objMulta = $MIOLO->GetBusiness($module,'multa');

		$query = $this->objMulta->ListMultas($idusuario);
		
		$datagrid = new DataGrid2($query, $columns, '',0);

		//nome do usuario
		//$this->objUsuario = $MIOLO->GetBusiness($module,'usuario');
		//$usuario = $this->objUsuario->GetById($this->manager->GetLogin()->idkey);

		//$datagrid->SetTitle('Multas Pendentes para o Usuário ' . $usuario[0][1]);
		$datagrid->SetTitle('Multas Pendentes para o Usuário ' . $usuario->nome);
		$datagrid->SetWidth('99%');
		$datagrid->SetClose($MIOLO->GetActionURL($module,'main'));

		$fields = array($datagrid,);

		$this->SetFields($fields);

	}

}
?>
